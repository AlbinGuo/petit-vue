{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/array.js","../../src/observe.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(obj) {\r\n  return obj !== null && typeof obj === \"object\";\r\n}\r\n\r\n// 定义一个defineProperty\r\nexport function def (obj, key, val) {\r\n  Object.defineProperty (obj, key, {\r\n    enumerable: false, // 不可枚举，不可被遍历\r\n    configurable: true, // 可配置\r\n    value: val,\r\n    writable: true // 可写\r\n  })\r\n}","// 需要重写数组中的7个方法， push pop shift unshift splice sort reverse\r\n// 会导致数组的长度发生变化，需要通知观察者\r\nconst arrayProto = Array.prototype\r\n// value.__proto__ = arrayMethods 将数组的原型指向arrayMethods，这样就可以访问到数组中我们重写的方法 。\r\n// arrayMethods.__proto__ = arrayProto 将arrayMethods的原型指向数组的原型\r\nexport const arrayMethods = Object.create(arrayProto)\r\n\r\nconst methodsToPatch = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'splice',\r\n  'sort',\r\n  'reverse'\r\n]\r\n\r\nmethodsToPatch.forEach(method => {\r\n  // 数组原生方法\r\n  const original = arrayProto[method]\r\n  // 给数组arrayMethods上添加要重写的这七种方法\r\n  arrayMethods[method] = function mutator (...args) {\r\n    // 调用原生的Array.prototype上的方法，此时args还没有被监测\r\n    const result = arrayProto[method].apply(this, args)\r\n    // push,unshift添加的元素可能是对象，需要观察\r\n    let inserted; // 当前数组要插入的元素\r\n    const ob = this.__ob__\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n        break\r\n      default:\r\n        break;\r\n    }\r\n    // 对inserted进行观察\r\n    console.log('inserted',inserted)\r\n    if(inserted) ob.observerArray(inserted)\r\n    \r\n    return result\r\n  }\r\n  \r\n})","/**\r\n * 对传递过来的data对象使用Object.defineProperty进行重新定义(添加get/set方法) - ES5\r\n * Object.defineProperty不兼容IE8以及以下版本\r\n */\r\nimport { isObject, def } from \"./util/index\";\r\nimport {arrayMethods} from \"./array\";\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // 给初始对象或者，每一个数组中push、unshift进来的对象添加__ob__属性\r\n    // value.__ob__ = this \r\n    def(value, '__ob__', this)\r\n\r\n    // Vue中如果数据太复杂，嵌套的层次太多，需要递归去解析对象中的属性，以此增加get/set方法\r\n    // 这样比较耗性能，所以Vue3中使用Proxy来解决了这个问题，提升复杂数据结构下数据解析带来的性能问题\r\n    if(Array.isArray(value)) {\r\n      // 如果是数组的话，并不会对索引进行观测，因为会导致性能问题\r\n      // 前端开发中很少去操作索引 push shift unshift\r\n      value.__proto__ = arrayMethods;\r\n      // 如果数组中放的是对象，再进行观测\r\n      this.observerArray(value)\r\n    }else{\r\n      // 对对象进行观测\r\n      this.walk(value);\r\n    }\r\n  }\r\n  /**\r\n   * Vue 源码中使用的是for循环处理 observer/index.js\r\n   * Walk through all properties and convert them into\r\n   * getter/setters. This method should only be called when\r\n   * value type is Object.\r\n   */\r\n  // walk (obj: Object) {\r\n  //   const keys = Object.keys(obj)\r\n  //   for (let i = 0; i < keys.length; i++) {\r\n  //     defineReactive(obj, keys[i])\r\n  //   }\r\n  // }\r\n  walk(data) {\r\n    // 遍历data中所有属性\r\n    let keys = Object.keys(data);\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n\r\n  observerArray(items) {\r\n    console.log('items:',items)\r\n    // 遍历数组中的每一项\r\n    items.forEach(item => {\r\n      observe(item);\r\n    });\r\n  }\r\n}\r\n\r\nexport function defineReactive(obj, key, value) {\r\n  // 递归实现深度劫持\r\n  observe(value);\r\n  Object.defineProperty(obj, key, {\r\n    enumerable: true,\r\n    configurable: true,\r\n    get: function reactiveGetter() {\r\n      return value;\r\n    },\r\n    set: function reactiveSetter(newVal) {\r\n      if (newVal === value) return;\r\n      // 如果set一个对象也要进行劫持,observe\r\n      observe(newVal);\r\n      value = newVal;\r\n      console.log(\"试图已更新\");\r\n    }\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  if (!isObject(data)) return;\r\n  // 如果是对象，那么对该对象进行观测\r\n  return new Observer(data);\r\n}\r\n","import { observe } from \"./observe\";\r\n\r\nexport function stateMixin() {}\r\n\r\nexport function initState(vm) {\r\n  const opt = vm.$options;\r\n  if (opt.props) initProps(vm);\r\n  if (opt.methods) initMethods(vm);\r\n  if (opt.data) initData(vm);\r\n  if (opt.computed) initComputed(vm);\r\n  if (opt.watch) initWatch(vm);\r\n}\r\n\r\nfunction initProps(vm) {}\r\n\r\nfunction initMethods(vm) {}\r\n\r\nfunction initData(vm) {\r\n  // 传递过来的data，此时data可能是函数，也可能是对象{}\r\n  // 但最终都要转为对象\r\n  let data = vm.$options.data;\r\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data || {};\r\n  // 对象劫持，转为响应式数据->MVVM\r\n  observe(data);\r\n}\r\n\r\nfunction initComputed(vm) {}\r\n\r\nfunction initWatch(vm) {}\r\n"," // 模板编译的正则表达式\r\n // Regular Expressions for parsing tags and attributes\r\n // copy from packages\\vue-template-compiler\\browser.js\r\n // 匹配标签伤的属性 id=\"app\" id='app' id=app\r\n var attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n var dynamicArgAttribute = /^\\s*((?:v-[\\w-]+:|@|:|#)\\[[^=]+?\\][^\\s\"'<>\\/=]*)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n // 标签：abc-aaa\r\n var ncname = \"[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z\" + (unicodeRegExp.source) + \"]*\";\r\n // <aaa:bbb>\r\n var qnameCapture = \"((?:\" + ncname + \"\\\\:)?\" + ncname + \")\";\r\n // 标签开头的正则，捕获的内容是标签名\r\n var startTagOpen = new RegExp((\"^<\" + qnameCapture));\r\n // 匹配开始标签的结束符 >\r\n var startTagClose = /^\\s*(\\/?)>/;\r\n // 匹配结尾标签: </div>\r\n var endTag = new RegExp((\"^<\\\\/\" + qnameCapture + \"[^>]*>\"));\r\n var doctype = /^<!DOCTYPE [^>]+>/i;\r\n var defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // {{ name }}\r\n\r\n// AST语法树：用对象来描述js的原生语法，虚拟DOM:用对象描述dom节点\r\nexport function compileToFunction (template) {\r\n  console.log('---template', template)\r\n  return function render(){\r\n\r\n  }\r\n}\r\n\r\n{/* <div id='app'>\r\n  <p>hello</p>\r\n</div>\r\n\r\n// Dom转为AST语法树\r\nlet root = {\r\n  tag: 'div'\r\n  attrs: [{name: 'id', value: 'app'}],\r\n  type: 1, // dom的nodetype是1\r\n  children: [{\r\n    tag: 'p',\r\n    attrs: [],\r\n    type:1,  // dom的nodetype是1\r\n    children: [{\r\n      type: 3, // 文本节点\r\n      text: 'hello'\r\n    }]\r\n  }]\r\n} */}","import { initState } from \"./state\";\r\nimport { compileToFunction } from \"./compiler/index.js\";\r\n\r\n// 在Vue原型上绑定私有的初始化方法_init\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    const vm = this;\r\n    vm.$options = options;\r\n    // 状态初始化: 初始化顺序：props-methods-data-computed-watch\r\n    initState(vm);\r\n    // 如果用户传递了el, 则实现挂载流程，将页面渲染出来\r\n    if(vm.$options.el){\r\n      // 挂载模板\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm= this\r\n    const options = vm.$options\r\n    // 获取dom元素\r\n    el = document.querySelector(el)\r\n    // vue解析template的执行顺序：render -> template:'#app' -> outerHTML\r\n    if(!options.render){\r\n      // 对模板进行编译\r\n      let template = options.template // 取出模板\r\n      if(!template && el){\r\n        template = el.outerHTML\r\n      }\r\n      \r\n      // template编译成render函数\r\n      const render = compileToFunction(template)\r\n      options.render = render\r\n    }\r\n  }\r\n  \r\n}\r\n","import { initMixin } from \"./init\";\r\nimport { stateMixin } from \"./state\";\r\n\r\n// Vue的构造函数\r\nfunction Vue(options) {\r\n  // Vue的初始化操作\r\n  this._init(options);\r\n}\r\n\r\n// 在Vue原型上绑定_init初始化方法\r\ninitMixin(Vue);\r\n// 状态初始化\r\nstateMixin();\r\n\r\nexport default Vue;\r\n"],"names":["isObject","obj","def","key","val","Object","defineProperty","enumerable","configurable","value","writable","arrayProto","Array","prototype","arrayMethods","create","methodsToPatch","forEach","method","mutator","args","result","apply","inserted","ob","__ob__","slice","console","log","observerArray","Observer","isArray","__proto__","walk","data","keys","defineReactive","items","item","observe","get","reactiveGetter","set","reactiveSetter","newVal","initState","vm","opt","$options","props","initProps","methods","initMethods","initData","computed","initComputed","watch","initWatch","_data","call","unicodeRegExp","source","compileToFunction","template","render","initMixin","Vue","_init","options","el","$mount","document","querySelector","outerHTML"],"mappings":"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"}