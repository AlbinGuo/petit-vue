{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observe.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(obj) {\r\n  return obj !== null && typeof obj === \"object\";\r\n}\r\n","/**\r\n * 对传递过来的data对象使用Object.defineProperty进行重新定义(添加get/set方法) - ES5\r\n * Object.defineProperty不兼容IE8以及以下版本\r\n */\r\nimport { isObject } from \"./util/index\";\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // Vue中如果数据太复杂，嵌套的层次太多，需要递归去解析对象中的属性，以此增加get/set方法\r\n    // 这样比较耗性能，所以Vue3中使用Proxy来解决了这个问题，提升复杂数据结构下数据解析带来的性能问题\r\n    this.walk(value);\r\n  }\r\n  /**\r\n   * Vue 源码中使用的是for循环处理 observer/index.js\r\n   * Walk through all properties and convert them into\r\n   * getter/setters. This method should only be called when\r\n   * value type is Object.\r\n   */\r\n  // walk (obj: Object) {\r\n  //   const keys = Object.keys(obj)\r\n  //   for (let i = 0; i < keys.length; i++) {\r\n  //     defineReactive(obj, keys[i])\r\n  //   }\r\n  // }\r\n  walk(data) {\r\n    // 遍历data中所有属性\r\n    let keys = Object.keys(data);\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n}\r\n\r\nexport function defineReactive(obj, key, value) {\r\n  // 递归实现深度劫持\r\n  observe(value);\r\n  Object.defineProperty(obj, key, {\r\n    enumerable: true,\r\n    configurable: true,\r\n    get: function reactiveGetter() {\r\n      return value;\r\n    },\r\n    set: function reactiveSetter(newVal) {\r\n      if (newVal === value) return;\r\n      // 如果set一个对象也要进行劫持,observe\r\n      observe(newVal);\r\n      value = newVal;\r\n      console.log(\"试图已更新\");\r\n    }\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  if (!isObject(data)) return;\r\n  // 如果是对象，那么对该对象进行观测\r\n  return new Observer(data);\r\n}\r\n","import { observe } from \"./observe\";\r\n\r\nexport function stateMixin() {}\r\n\r\nexport function initState(vm) {\r\n  const opt = vm.$options;\r\n  if (opt.props) initProps(vm);\r\n  if (opt.methods) initMethods(vm);\r\n  if (opt.data) initData(vm);\r\n  if (opt.computed) initComputed(vm);\r\n  if (opt.watch) initWatch(vm);\r\n}\r\n\r\nfunction initProps(vm) {}\r\n\r\nfunction initMethods(vm) {}\r\n\r\nfunction initData(vm) {\r\n  // 传递过来的data，此时data可能是函数，也可能是对象{}\r\n  // 但最终都要转为对象\r\n  let data = vm.$options.data;\r\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data || {};\r\n  // 对象劫持，转为响应式数据->MVVM\r\n  observe(data);\r\n}\r\n\r\nfunction initComputed(vm) {}\r\n\r\nfunction initWatch(vm) {}\r\n","import { initState } from \"./state\";\r\n// 在Vue原型上绑定私有的初始化方法_init\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    const vm = this;\r\n    vm.$options = options;\r\n    // 状态初始化: 初始化顺序：props-methods-data-computed-watch\r\n    initState(vm);\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\nimport { stateMixin } from \"./state\";\r\n\r\n// Vue的构造函数\r\nfunction Vue(options) {\r\n  // Vue的初始化操作\r\n  this._init(options);\r\n}\r\n\r\n// 在Vue原型上绑定_init初始化方法\r\ninitMixin(Vue);\r\n// 状态初始化\r\nstateMixin();\r\n\r\nexport default Vue;\r\n"],"names":["isObject","obj","Observer","value","walk","data","keys","Object","forEach","key","defineReactive","observe","defineProperty","enumerable","configurable","get","reactiveGetter","set","reactiveSetter","newVal","console","log","initState","vm","opt","$options","props","initProps","methods","initMethods","initData","computed","initComputed","watch","initWatch","_data","call","initMixin","Vue","prototype","_init","options"],"mappings":"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"}