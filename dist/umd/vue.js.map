{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/array.js","../../src/observe.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(obj) {\r\n  return obj !== null && typeof obj === \"object\";\r\n}\r\n\r\n// 定义一个defineProperty\r\nexport function def (obj, key, val) {\r\n  Object.defineProperty (obj, key, {\r\n    enumerable: false, // 不可枚举，不可被遍历\r\n    configurable: true, // 可配置\r\n    value: val,\r\n    writable: true // 可写\r\n  })\r\n}","// 需要重写数组中的7个方法， push pop shift unshift splice sort reverse\r\n// 会导致数组的长度发生变化，需要通知观察者\r\nconst arrayProto = Array.prototype\r\n// value.__proto__ = arrayMethods 将数组的原型指向arrayMethods，这样就可以访问到数组中我们重写的方法 。\r\n// arrayMethods.__proto__ = arrayProto 将arrayMethods的原型指向数组的原型\r\nexport const arrayMethods = Object.create(arrayProto)\r\n\r\nconst methodsToPatch = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'splice',\r\n  'sort',\r\n  'reverse'\r\n]\r\n\r\nmethodsToPatch.forEach(method => {\r\n  // 数组原生方法\r\n  const original = arrayProto[method]\r\n  // 给数组arrayMethods上添加要重写的这七种方法\r\n  arrayMethods[method] = function mutator (...args) {\r\n    // 调用原生的Array.prototype上的方法，此时args还没有被监测\r\n    arrayProto[method].apply(this, args)\r\n    // push,unshift添加的元素可能是对象，需要观察\r\n    let inserted; // 当前数组要插入的元素\r\n    const ob = this.__ob__\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n      default:\r\n        break;\r\n      // 对inserted进行观察\r\n      if(inserted) ob.observerArray(inserted)\r\n\r\n    }\r\n    \r\n  }\r\n  \r\n})","/**\r\n * 对传递过来的data对象使用Object.defineProperty进行重新定义(添加get/set方法) - ES5\r\n * Object.defineProperty不兼容IE8以及以下版本\r\n */\r\nimport { isObject, def } from \"./util/index\";\r\nimport {arrayMethods} from \"./array\";\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // 给每一个数组中push、unshift进来的对象添加__ob__属性\r\n    // value.__ob__ = this \r\n    def(value, '__ob__', this)\r\n\r\n    // Vue中如果数据太复杂，嵌套的层次太多，需要递归去解析对象中的属性，以此增加get/set方法\r\n    // 这样比较耗性能，所以Vue3中使用Proxy来解决了这个问题，提升复杂数据结构下数据解析带来的性能问题\r\n    if(Array.isArray(value)) {\r\n      // 如果是数组的话，并不会对索引进行观测，因为会导致性能问题\r\n      // 前端开发中很少去操作索引 push shift unshift\r\n      value.__proto__ = arrayMethods;\r\n      // 如果数组中放的是对象，再进行观测\r\n      this.observerArray(value)\r\n    }else{\r\n      // 对对象进行观测\r\n      this.walk(value);\r\n    }\r\n  }\r\n  /**\r\n   * Vue 源码中使用的是for循环处理 observer/index.js\r\n   * Walk through all properties and convert them into\r\n   * getter/setters. This method should only be called when\r\n   * value type is Object.\r\n   */\r\n  // walk (obj: Object) {\r\n  //   const keys = Object.keys(obj)\r\n  //   for (let i = 0; i < keys.length; i++) {\r\n  //     defineReactive(obj, keys[i])\r\n  //   }\r\n  // }\r\n  walk(data) {\r\n    // 遍历data中所有属性\r\n    let keys = Object.keys(data);\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n\r\n  observerArray(items) {\r\n    // 遍历数组中的每一项\r\n    items.forEach(item => {\r\n      observe(item);\r\n    });\r\n  }\r\n}\r\n\r\nexport function defineReactive(obj, key, value) {\r\n  // 递归实现深度劫持\r\n  observe(value);\r\n  Object.defineProperty(obj, key, {\r\n    enumerable: true,\r\n    configurable: true,\r\n    get: function reactiveGetter() {\r\n      return value;\r\n    },\r\n    set: function reactiveSetter(newVal) {\r\n      if (newVal === value) return;\r\n      // 如果set一个对象也要进行劫持,observe\r\n      observe(newVal);\r\n      value = newVal;\r\n      console.log(\"试图已更新\");\r\n    }\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  if (!isObject(data)) return;\r\n  // 如果是对象，那么对该对象进行观测\r\n  return new Observer(data);\r\n}\r\n","import { observe } from \"./observe\";\r\n\r\nexport function stateMixin() {}\r\n\r\nexport function initState(vm) {\r\n  const opt = vm.$options;\r\n  if (opt.props) initProps(vm);\r\n  if (opt.methods) initMethods(vm);\r\n  if (opt.data) initData(vm);\r\n  if (opt.computed) initComputed(vm);\r\n  if (opt.watch) initWatch(vm);\r\n}\r\n\r\nfunction initProps(vm) {}\r\n\r\nfunction initMethods(vm) {}\r\n\r\nfunction initData(vm) {\r\n  // 传递过来的data，此时data可能是函数，也可能是对象{}\r\n  // 但最终都要转为对象\r\n  let data = vm.$options.data;\r\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data || {};\r\n  // 对象劫持，转为响应式数据->MVVM\r\n  observe(data);\r\n}\r\n\r\nfunction initComputed(vm) {}\r\n\r\nfunction initWatch(vm) {}\r\n","import { initState } from \"./state\";\r\n// 在Vue原型上绑定私有的初始化方法_init\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    const vm = this;\r\n    vm.$options = options;\r\n    // 状态初始化: 初始化顺序：props-methods-data-computed-watch\r\n    initState(vm);\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\nimport { stateMixin } from \"./state\";\r\n\r\n// Vue的构造函数\r\nfunction Vue(options) {\r\n  // Vue的初始化操作\r\n  this._init(options);\r\n}\r\n\r\n// 在Vue原型上绑定_init初始化方法\r\ninitMixin(Vue);\r\n// 状态初始化\r\nstateMixin();\r\n\r\nexport default Vue;\r\n"],"names":["isObject","obj","def","key","val","Object","defineProperty","enumerable","configurable","value","writable","arrayProto","Array","prototype","arrayMethods","create","methodsToPatch","forEach","method","mutator","args","apply","__ob__","inserted","slice","Observer","isArray","__proto__","observerArray","walk","data","keys","defineReactive","items","item","observe","get","reactiveGetter","set","reactiveSetter","newVal","console","log","initState","vm","opt","$options","props","initProps","methods","initMethods","initData","computed","initComputed","watch","initWatch","_data","call","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAO,SAASA,QAAT,CAAkBC,GAAlB,EAAuB;EAC5B,EAAA,OAAOA,GAAG,KAAK,IAAR,IAAgB,OAAOA,CAAAA,GAAP,MAAe,QAAtC,CAAA;EACD;;EAGM,SAASC,GAAT,CAAcD,GAAd,EAAmBE,GAAnB,EAAwBC,GAAxB,EAA6B;EAClCC,EAAAA,MAAM,CAACC,cAAP,CAAuBL,GAAvB,EAA4BE,GAA5B,EAAiC;EAC/BI,IAAAA,UAAU,EAAE,KADmB;EACZ;EACnBC,IAAAA,YAAY,EAAE,IAFiB;EAEX;EACpBC,IAAAA,KAAK,EAAEL,GAHwB;EAI/BM,IAAAA,QAAQ,EAAE,IAJqB;;EAAA,GAAjC,CAAA,CAAA;EAMD;;ECZD;EACA;EACA,IAAMC,UAAU,GAAGC,KAAK,CAACC,SAAzB;EAEA;;EACO,IAAMC,YAAY,GAAGT,MAAM,CAACU,MAAP,CAAcJ,UAAd,CAArB,CAAA;EAEP,IAAMK,cAAc,GAAG,CACrB,MADqB,EAErB,KAFqB,EAGrB,OAHqB,EAIrB,SAJqB,EAKrB,QALqB,EAMrB,MANqB,EAOrB,SAPqB,CAAvB,CAAA;EAUAA,cAAc,CAACC,OAAf,CAAuB,UAAAC,MAAM,EAAI;;EAI/BJ,EAAAA,YAAY,CAACI,MAAD,CAAZ,GAAuB,SAASC,OAAT,GAA2B;EAAA,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAANC,IAAM,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;EAANA,MAAAA,IAAM,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EAChD;EACAT,IAAAA,UAAU,CAACO,MAAD,CAAV,CAAmBG,KAAnB,CAAyB,IAAzB,EAA+BD,IAA/B,CAAA,CAFgD;;EAKhD,IAAW,IAAA,CAAKE,OAAhB;;EACA,IAAA,QAAQJ,MAAR;EACE,MAAA,KAAK,MAAL,CAAA;EACA,MAAA,KAAK,SAAL;;EAEA,MAAA,KAAK,QAAL;EACEK,QAAWH,IAAI,CAACI,KAAL,CAAW,CAAX,CAAX,CAAA;EALJ,KAAA;EAaD,GAnBD,CAAA;EAqBD,CAzBD,CAAA;;MCVMC;EACJ,EAAA,SAAA,QAAA,CAAYhB,KAAZ,EAAmB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EACjB;EACA;EACAP,IAAAA,GAAG,CAACO,KAAD,EAAQ,QAAR,EAAkB,IAAlB,CAAH,CAHiB;EAMjB;;EACA,IAAA,IAAGG,KAAK,CAACc,OAAN,CAAcjB,KAAd,CAAH,EAAyB;EACvB;EACA;EACAA,MAAAA,KAAK,CAACkB,SAAN,GAAkBb,YAAlB,CAHuB;;EAKvB,MAAKc,IAAAA,CAAAA,aAAL,CAAmBnB,KAAnB,CAAA,CAAA;EACD,KAND,MAMK;EACH;EACA,MAAKoB,IAAAA,CAAAA,IAAL,CAAUpB,KAAV,CAAA,CAAA;EACD,KAAA;EACF,GAAA;EACD;EACF;EACA;EACA;EACA;EACA;EACE;EACA;EACA;EACA;EACA;EACA;;;;;EACA,IAAA,KAAA,EAAA,SAAA,IAAA,CAAKqB,IAAL,EAAW;EACT;EACA,MAAA,IAAIC,IAAI,GAAG1B,MAAM,CAAC0B,IAAP,CAAYD,IAAZ,CAAX,CAAA;EACAC,MAAAA,IAAI,CAACd,OAAL,CAAa,UAAAd,GAAG,EAAI;EAClB6B,QAAAA,cAAc,CAACF,IAAD,EAAO3B,GAAP,EAAY2B,IAAI,CAAC3B,GAAD,CAAhB,CAAd,CAAA;EACD,OAFD,CAAA,CAAA;EAGD,KAAA;;;EAED,IAAA,KAAA,EAAA,SAAA,aAAA,CAAc8B,KAAd,EAAqB;EACnB;EACAA,MAAAA,KAAK,CAAChB,OAAN,CAAc,UAAAiB,IAAI,EAAI;EACpBC,QAAAA,OAAO,CAACD,IAAD,CAAP,CAAA;EACD,OAFD,CAAA,CAAA;EAGD,KAAA;;;;;;EAGI,SAASF,cAAT,CAAwB/B,GAAxB,EAA6BE,GAA7B,EAAkCM,KAAlC,EAAyC;EAC9C;EACA0B,EAAAA,OAAO,CAAC1B,KAAD,CAAP,CAAA;EACAJ,EAAAA,MAAM,CAACC,cAAP,CAAsBL,GAAtB,EAA2BE,GAA3B,EAAgC;EAC9BI,IAAAA,UAAU,EAAE,IADkB;EAE9BC,IAAAA,YAAY,EAAE,IAFgB;EAG9B4B,IAAAA,GAAG,EAAE,SAASC,cAAT,GAA0B;EAC7B,MAAA,OAAO5B,KAAP,CAAA;EACD,KAL6B;EAM9B6B,IAAAA,GAAG,EAAE,SAASC,cAAT,CAAwBC,MAAxB,EAAgC;EACnC,MAAA,IAAIA,MAAM,KAAK/B,KAAf,EAAsB,OADa;;EAGnC0B,MAAAA,OAAO,CAACK,MAAD,CAAP,CAAA;EACA/B,MAAAA,KAAK,GAAG+B,MAAR,CAAA;EACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAA,CAAA;EACD,KAAA;EAZ6B,GAAhC,CAAA,CAAA;EAcD,CAAA;EAEM,SAASP,OAAT,CAAiBL,IAAjB,EAAuB;EAC5B,EAAA,IAAI,CAAC9B,QAAQ,CAAC8B,IAAD,CAAb,EAAqB,OADO;;EAG5B,EAAA,OAAO,IAAIL,QAAJ,CAAaK,IAAb,CAAP,CAAA;EACD;;ECzEM,SAASa,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B,EAAA,IAAMC,GAAG,GAAGD,EAAE,CAACE,QAAf,CAAA;EACA,EAAA,IAAID,GAAG,CAACE,KAAR,EAAeC,CAAA;EACf,EAAA,IAAIH,GAAG,CAACI,OAAR,EAAiBC,CAAA;EACjB,EAAA,IAAIL,GAAG,CAACf,IAAR,EAAcqB,QAAQ,CAACP,EAAD,CAAR,CAAA;EACd,EAAA,IAAIC,GAAG,CAACO,QAAR,EAAkBC,CAAA;EAClB,EAAA,IAAIR,GAAG,CAACS,KAAR,EAAeC,CAAA;EAChB,CAAA;;EAMD,SAASJ,QAAT,CAAkBP,EAAlB,EAAsB;EACpB;EACA;EACA,EAAA,IAAId,IAAI,GAAGc,EAAE,CAACE,QAAH,CAAYhB,IAAvB,CAAA;EACAA,EAAAA,IAAI,GAAGc,EAAE,CAACY,KAAH,GAAW,OAAO1B,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAAC2B,IAAL,CAAUb,EAAV,CAA7B,GAA6Cd,IAAI,IAAI,EAAvE,CAJoB;;EAMpBK,EAAAA,OAAO,CAACL,IAAD,CAAP,CAAA;EACD;;ECtBM,SAAS4B,SAAT,CAAmBC,GAAnB,EAAwB;EAC7BA,EAAAA,GAAG,CAAC9C,SAAJ,CAAc+C,KAAd,GAAsB,UAASC,OAAT,EAAkB;EACtC,IAAMjB,IAAAA,EAAE,GAAG,IAAX,CAAA;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAce,OAAd,CAFsC;;EAItClB,IAAAA,SAAS,CAACC,EAAD,CAAT,CAAA;EACD,GALD,CAAA;EAMD;;ECLD,SAASe,GAAT,CAAaE,OAAb,EAAsB;EACpB;EACA,EAAKD,IAAAA,CAAAA,KAAL,CAAWC,OAAX,CAAA,CAAA;EACD;;;EAGDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}