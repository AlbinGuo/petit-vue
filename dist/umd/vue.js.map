{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/array.js","../../src/observe.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(obj) {\r\n  return obj !== null && typeof obj === \"object\";\r\n}\r\n","// 需要重写数组中的7个方法， push pop shift unshift splice sort reverse\r\n// 会导致数组的长度发生变化，需要通知观察者\r\nconst arrayProto = Array.prototype\r\n// value.__proto__ = arrayMethods 将数组的原型指向arrayMethods，这样就可以访问到数组中我们重写的方法 。\r\n// arrayMethods.__proto__ = arrayProto 将arrayMethods的原型指向数组的原型\r\nexport const arrayMethods = Object.create(arrayProto)\r\n\r\nconst methodsToPatch = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'splice',\r\n  'sort',\r\n  'reverse'\r\n]","/**\r\n * 对传递过来的data对象使用Object.defineProperty进行重新定义(添加get/set方法) - ES5\r\n * Object.defineProperty不兼容IE8以及以下版本\r\n */\r\nimport { isObject } from \"./util/index\";\r\nimport {arrayMethods} from \"./array\";\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // Vue中如果数据太复杂，嵌套的层次太多，需要递归去解析对象中的属性，以此增加get/set方法\r\n    // 这样比较耗性能，所以Vue3中使用Proxy来解决了这个问题，提升复杂数据结构下数据解析带来的性能问题\r\n    if(Array.isArray(value)) {\r\n      // 如果是数组的话，并不会对索引进行观测，因为会导致性能问题\r\n      // 前端开发中很少去操作索引 push shift unshift\r\n      value.__proto__ = arrayMethods;\r\n      // 如果数组中放的是对象，再进行观测\r\n      this.observerArray(value)\r\n    }else{\r\n      this.walk(value);\r\n    }\r\n  }\r\n  /**\r\n   * Vue 源码中使用的是for循环处理 observer/index.js\r\n   * Walk through all properties and convert them into\r\n   * getter/setters. This method should only be called when\r\n   * value type is Object.\r\n   */\r\n  // walk (obj: Object) {\r\n  //   const keys = Object.keys(obj)\r\n  //   for (let i = 0; i < keys.length; i++) {\r\n  //     defineReactive(obj, keys[i])\r\n  //   }\r\n  // }\r\n  walk(data) {\r\n    // 遍历data中所有属性\r\n    let keys = Object.keys(data);\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n\r\n  observerArray(items) {\r\n    // 遍历数组中的每一项\r\n    items.forEach(item => {\r\n      observe(item);\r\n    });\r\n  }\r\n}\r\n\r\nexport function defineReactive(obj, key, value) {\r\n  // 递归实现深度劫持\r\n  observe(value);\r\n  Object.defineProperty(obj, key, {\r\n    enumerable: true,\r\n    configurable: true,\r\n    get: function reactiveGetter() {\r\n      return value;\r\n    },\r\n    set: function reactiveSetter(newVal) {\r\n      if (newVal === value) return;\r\n      // 如果set一个对象也要进行劫持,observe\r\n      observe(newVal);\r\n      value = newVal;\r\n      console.log(\"试图已更新\");\r\n    }\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  if (!isObject(data)) return;\r\n  // 如果是对象，那么对该对象进行观测\r\n  return new Observer(data);\r\n}\r\n","import { observe } from \"./observe\";\r\n\r\nexport function stateMixin() {}\r\n\r\nexport function initState(vm) {\r\n  const opt = vm.$options;\r\n  if (opt.props) initProps(vm);\r\n  if (opt.methods) initMethods(vm);\r\n  if (opt.data) initData(vm);\r\n  if (opt.computed) initComputed(vm);\r\n  if (opt.watch) initWatch(vm);\r\n}\r\n\r\nfunction initProps(vm) {}\r\n\r\nfunction initMethods(vm) {}\r\n\r\nfunction initData(vm) {\r\n  // 传递过来的data，此时data可能是函数，也可能是对象{}\r\n  // 但最终都要转为对象\r\n  let data = vm.$options.data;\r\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data || {};\r\n  // 对象劫持，转为响应式数据->MVVM\r\n  observe(data);\r\n}\r\n\r\nfunction initComputed(vm) {}\r\n\r\nfunction initWatch(vm) {}\r\n","import { initState } from \"./state\";\r\n// 在Vue原型上绑定私有的初始化方法_init\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    const vm = this;\r\n    vm.$options = options;\r\n    // 状态初始化: 初始化顺序：props-methods-data-computed-watch\r\n    initState(vm);\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\nimport { stateMixin } from \"./state\";\r\n\r\n// Vue的构造函数\r\nfunction Vue(options) {\r\n  // Vue的初始化操作\r\n  this._init(options);\r\n}\r\n\r\n// 在Vue原型上绑定_init初始化方法\r\ninitMixin(Vue);\r\n// 状态初始化\r\nstateMixin();\r\n\r\nexport default Vue;\r\n"],"names":["isObject","obj","arrayProto","Array","prototype","arrayMethods","Object","create","Observer","value","isArray","__proto__","observerArray","walk","data","keys","forEach","key","defineReactive","items","item","observe","defineProperty","enumerable","configurable","get","reactiveGetter","set","reactiveSetter","newVal","console","log","initState","vm","opt","$options","props","initProps","methods","initMethods","initData","computed","initComputed","watch","initWatch","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}